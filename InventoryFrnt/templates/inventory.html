{% extends "base.html" %}
{% block title %}Inventory{% endblock %}
{% block content %}
<h1>Inventory Management</h1>
<nav style="background-color: #6c757d; color: white; padding: 0.5rem; margin-bottom: 1rem; border-radius: 4px;">
    <a href="{{ url_for('suppliers') }}" style="color: white; margin: 0 1rem;">Suppliers</a>
    <a href="{{ url_for('reports') }}" style="color: white; margin: 0 1rem;">Reports</a>
    <a href="{{ url_for('transactions') }}" style="color: white; margin: 0 1rem;">Transactions</a>
</nav>
<h2>Items</h2>
<a href="{{ url_for('add_item') }}" class="btn btn-edit" style="margin-bottom: 1rem; display: inline-block;">Add Item</a>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Category</th>
            <th>Sell Quantity</th>
            <th>Stock Value</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.description }}</td>
            <td>{{ item.quantity }}</td>
            <td>₹{{ item.price }}</td>
            <td>{{ item.category }}</td>
            <td>
                <form style="display: inline;" action="{{ url_for('sell_item', item_id=item.id) }}" method="post">
                    <input type="number" name="quantity" data-item-id="{{ item.id }}" data-price="{{ item.price }}" min="1" max="{{ item.quantity }}" placeholder="Qty" required style="width: 60px;">
                    <button type="submit" class="btn btn-edit" style="padding: 0.3rem 0.5rem;">Sell</button>
                    <br><small>Sale: ₹<span class="sale-value" data-item-id="{{ item.id }}">0</span></small>
                </form>
            </td>
            <td>₹{{ "%.2f"|format(item.price * item.quantity) }}</td>
            <td>
                <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-edit">Edit</a>
                <a href="{{ url_for('delete_item', item_id=item.id) }}" class="btn btn-delete" onclick="return confirm('Are you sure?')">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('input[name="quantity"]');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                const itemId = this.getAttribute('data-item-id');
                const price = parseFloat(this.getAttribute('data-price'));
                const qty = parseInt(this.value) || 0;
                const span = document.querySelector(`.sale-value[data-item-id="${itemId}"]`);
                if (span) {
                    span.textContent = (price * qty).toFixed(2);
                }
            });
        });
    });
</script>
{% endblock %}